<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Panel Użytkownika - AutoRent</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="/css/custom.css" rel="stylesheet">
</head>
<body>
<!-- Inkluzja header.html jako fragment -->
<div th:replace="~{fragments/header :: header}"></div>

<div class="container user-panel-container">
  <!-- Komunikaty sukcesu i błędów -->
  <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
    <span th:text="${message}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Zamknij"></button>
  </div>
  <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
    <span th:text="${error}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Zamknij"></button>
  </div>

  <!-- Sekcja Informacji o Użytkowniku -->
  <div class="user-info">
    <h2><i class="fas fa-user-circle me-2"></i>Informacje o Użytkowniku</h2>
    <hr>
    <div class="row">
      <div class="col-md-6 mb-3">
        <p><strong>Login:</strong> <span th:text="${username}"></span></p>
        <p><strong>Imię:</strong> <span th:text="${name}"></span></p>
        <p><strong>Nazwisko:</strong> <span th:text="${surname}"></span></p>
      </div>
      <div class="col-md-6 mb-3">
        <p><strong>Email:</strong> <span th:text="${email}"></span></p>
        <p><strong>Numer telefonu:</strong> <span th:text="${phone}"></span></p>
      </div>
    </div>
  </div>

  <!-- Sekcja Edycji Danych -->
  <div class="actions mt-4" style="margin-bottom: 30px">
    <a href="/user-panel/update" class="btn btn-primary">
      <i class="fas fa-edit me-2"></i>Edytuj Dane
    </a>
  </div>

  <div th:if="${role != 'OWNER'}">
    <!-- Sekcja Aktualnych Wypożyczeń -->
    <div class="rentals-section">
      <h3><i class="fas fa-car me-2"></i>Twoje Aktualne Wypożyczenia</h3>
      <hr>
      <div th:if="${#lists.isEmpty(currentRentals)}" class="text-center">
        <p>Brak aktualnie wypożyczonych samochodów.</p>
      </div>
      <div th:if="${!#lists.isEmpty(currentRentals)}">
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
            <tr>
              <th>Samochód</th>
              <th>Data Wypożyczenia</th>
              <th>Data Zwrotu</th>
              <th>Akcje</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="rental : ${currentRentals}">
              <td th:text="${rental.car.brand + ' ' + rental.car.model}"></td>
              <td th:text="${rental.rentalDate}"></td>
              <td th:text="${rental.returnDate}"></td>
              <td>
                <form method="post" th:action="@{/rentals/cancel}" class="d-inline">
                  <input type="hidden" name="rentalId" th:value="${rental.id}"/>
                  <button type="submit" class="btn btn-danger btn-sm"
                          th:attr="disabled=${!rental.canBeCancelled}">
                    <i class="fas fa-times me-1"></i>Anuluj
                  </button>
                  <span th:if="${!rental.canBeCancelled}" class="text-muted">Nie można anulować</span>
                </form>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Sekcja Historii Wypożyczeń -->
    <div class="rentals-section">
      <h3><i class="fas fa-history me-2"></i>Historia Wypożyczeń</h3>
      <hr>
      <div th:if="${#lists.isEmpty(pastRentals)}" class="text-center">
        <p>Brak zakończonych wypożyczeń.</p>
      </div>
      <div th:if="${!#lists.isEmpty(pastRentals)}">
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
            <tr>
              <th>Samochód</th>
              <th>Data Wypożyczenia</th>
              <th>Data Zwrotu</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="rental : ${pastRentals}">
              <td th:text="${rental.car.brand + ' ' + rental.car.model}"></td>
              <td th:text="${rental.rentalDate}"></td>
              <td th:text="${rental.returnDate}"></td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


  <!-- Link powrotny do strony głównej -->
  <a href="/" class="back-link">← Powrót do Strony Głównej</a>
</div>

<!-- Bootstrap JS and dependencies (Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Opcjonalny skrypt JavaScript dla walidacji formularzy Bootstrap -->
<script src="/js/custom.js"></script>
</body>
</html>
